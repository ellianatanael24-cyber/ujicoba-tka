<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Uji Coba TKA</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; padding:0; text-align:center; }
    header { background:#004aad; color:white; padding:10px; position:fixed; top:0; left:0; right:0; z-index:1000; }
    #timer { position:fixed; top:10px; right:20px; font-size:18px; font-weight:bold; }
    #log { position:fixed; bottom:10px; left:10px; background:#eee; border:1px solid #aaa; padding:5px; font-size:12px; width:200px; max-height:150px; overflow:auto; text-align:left; }
    #container { margin-top:80px; padding:20px; }
    .hidden { display:none; }
    .btn { background:#004aad; color:white; padding:10px 20px; border:none; border-radius:5px; cursor:pointer; }
    .btn:hover { background:#0066ff; }
    .end-screen { font-size:24px; padding:50px; }
    .success { background:#c8e6c9; color:#2e7d32; height:100vh; }
    .fail { background:#ffcdd2; color:#b71c1c; height:100vh; }
  </style>
</head>
<body>

<header>
  <h2 id="judul">Uji Coba TKA</h2>
  <div id="timer" class="hidden">00:00</div>
</header>

<div id="container">
  <!-- Halaman Awal -->
  <div id="halaman-awal">
    <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/9/95/Logo_UTBK_SBMPTN.png/600px-Logo_UTBK_SBMPTN.png" alt="Logo" width="120">
    <h3>Petunjuk Ujian</h3>
    <p>1. Baca soal dengan teliti.<br>
       2. Jangan keluar dari layar penuh.<br>
       3. Jika keluar tab lebih dari 3 kali, ujian otomatis gagal.<br>
       4. Waktu ujian terbatas, kerjakan dengan tenang.</p>
    <button class="btn" onclick="mulaiFullscreen()">Mulai Ujian</button>
  </div>

  <!-- Halaman Ujian -->
  <div id="halaman-ujian" class="hidden">
    <iframe src="https://forms.gle/qVe7sedX4x4fmomh8" width="100%" height="500" frameborder="0"></iframe>
    <br><br>
    <button class="btn" onclick="selesaiUjian()">Selesai Ujian</button>
  </div>

  <!-- Halaman Selesai -->
  <div id="halaman-selesai" class="hidden end-screen success">
    <h1>✅ Selamat, ujian Anda telah selesai!</h1>
  </div>

  <!-- Halaman Gagal -->
  <div id="halaman-gagal" class="hidden end-screen fail">
    <h1>❌ Maaf, ujian Anda gagal!</h1>
    <p id="alasan-gagal"></p>
  </div>
</div>

<div id="log"></div>

<script>
  let waktuUjian = 10 * 60; // detik (contoh: 10 menit)
  let timerInterval;
  let pelanggaran = 0;
  const pelanggaranMaks = 3;

  const halamanAwal = document.getElementById("halaman-awal");
  const halamanUjian = document.getElementById("halaman-ujian");
  const halamanSelesai = document.getElementById("halaman-selesai");
  const halamanGagal = document.getElementById("halaman-gagal");
  const timerEl = document.getElementById("timer");
  const logEl = document.getElementById("log");
  const alasanGagal = document.getElementById("alasan-gagal");

  function logPelanggaran(pesan) {
    const now = new Date().toLocaleTimeString();
    logEl.innerHTML += `[${now}] ${pesan}<br>`;
    logEl.scrollTop = logEl.scrollHeight;
  }

  function mulaiFullscreen() {
    let elem = document.documentElement;
    if (elem.requestFullscreen) {
      elem.requestFullscreen().then(() => {
        mulaiUjian();
      }).catch(() => {
        alert("Anda harus mengizinkan fullscreen untuk memulai ujian.");
        kembaliKeAwal();
      });
    } else {
      mulaiUjian();
    }
  }

  function mulaiUjian() {
    halamanAwal.classList.add("hidden");
    halamanUjian.classList.remove("hidden");
    timerEl.classList.remove("hidden");
    startTimer();
  }

  function kembaliKeAwal() {
    halamanAwal.classList.remove("hidden");
    halamanUjian.classList.add("hidden");
    timerEl.classList.add("hidden");
  }

  function startTimer() {
    updateTimer();
    timerInterval = setInterval(() => {
      waktuUjian--;
      updateTimer();

      if (waktuUjian === 300) { // 5 menit
        document.body.style.background = "#ffe0e0";
        alert("Waktu tersisa 5 menit, segera selesaikan!");
      }
      if (waktuUjian === 60) { // 1 menit
        document.body.style.background = "#ff9999";
        alert("Waktu tersisa 1 menit, segera submit!");
      }
      if (waktuUjian <= 0) {
        clearInterval(timerInterval);
        gagalUjian("Waktu habis");
      }
    }, 1000);
  }

  function updateTimer() {
    let menit = Math.floor(waktuUjian / 60);
    let detik = waktuUjian % 60;
    timerEl.textContent = `${String(menit).padStart(2,"0")}:${String(detik).padStart(2,"0")}`;
  }

  function selesaiUjian() {
    clearInterval(timerInterval);
    halamanUjian.classList.add("hidden");
    halamanSelesai.classList.remove("hidden");
    timerEl.classList.add("hidden");
  }

  function gagalUjian(alasan) {
    clearInterval(timerInterval);
    halamanUjian.classList.add("hidden");
    halamanAwal.classList.add("hidden");
    halamanSelesai.classList.add("hidden");
    halamanGagal.classList.remove("hidden");
    timerEl.classList.add("hidden");
    alasanGagal.textContent = alasan;
  }

  // Deteksi pindah tab
  document.addEventListener("visibilitychange", () => {
    if (document.hidden) {
      pelanggaran++;
      logPelanggaran("Pindah tab terdeteksi ("+pelanggaran+")");
      if (pelanggaran >= pelanggaranMaks) {
        gagalUjian("Terlalu banyak pelanggaran (pindah tab/keluar fullscreen)");
      }
    }
  });

  // Deteksi keluar fullscreen
  document.addEventListener("fullscreenchange", () => {
    if (!document.fullscreenElement && !halamanAwal.classList.contains("hidden")) return;
    if (!document.fullscreenElement && !halamanAwal.classList.contains("hidden")) return;
    if (!document.fullscreenElement && !halamanUjian.classList.contains("hidden")) {
      pelanggaran++;
      logPelanggaran("Keluar fullscreen ("+pelanggaran+")");
      if (pelanggaran >= pelanggaranMaks) {
        gagalUjian("Keluar fullscreen lebih dari "+pelanggaranMaks+" kali");
      }
    }
  });
</script>
</body>
</html>
